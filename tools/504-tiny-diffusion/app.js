const translations={'zh-TW':{title:'輕量擴散模型',subtitle:'輕量級擴散模型快速生成，完全本地處理',privacyBadge:'100% 本地處理 · 零資料上傳',modelNotLoaded:'模型未載入',modelLoading:'模型載入中...',modelReady:'模型已就緒',loadModel:'載入模型',promptLabel:'輸入提示詞',style:'風格',generate:'開始生成',regenerate:'重新生成',processing:'正在處理中...',download:'下載結果',howItWorks:'如何運作？'},'en':{title:'Tiny Diffusion',subtitle:'Lightweight diffusion for quick generation, fully local',privacyBadge:'100% Local Processing · Zero Data Upload',modelNotLoaded:'Model not loaded',modelLoading:'Loading model...',modelReady:'Model ready',loadModel:'Load Model',promptLabel:'Enter Prompt',style:'Style',generate:'Generate',regenerate:'Regenerate',processing:'Processing...',download:'Download Result',howItWorks:'How It Works'}};let currentLang='zh-TW';const state={isModelLoaded:false,isProcessing:false,resultBlob:null};function setLanguage(lang){currentLang=lang;document.querySelectorAll('[data-i18n]').forEach(el=>{const key=el.getAttribute('data-i18n');if(translations[lang][key])el.textContent=translations[lang][key]});document.querySelectorAll('.lang-btn').forEach(btn=>btn.classList.remove('active'));document.getElementById(`lang-${lang==='zh-TW'?'zh':'en'}`).classList.add('active')}function t(key){return translations[currentLang][key]||key}const elements={loadModelBtn:document.getElementById('loadModelBtn'),statusIndicator:document.getElementById('statusIndicator'),statusText:document.getElementById('statusText'),progressContainer:document.getElementById('progressContainer'),progressFill:document.getElementById('progressFill'),progressPercent:document.getElementById('progressPercent'),qualitySlider:document.getElementById('qualitySlider'),qualityValue:document.getElementById('qualityValue'),generateBtn:document.getElementById('generateBtn'),resultArea:document.getElementById('resultArea'),resultImage:document.getElementById('resultImage'),processingOverlay:document.getElementById('processingOverlay'),downloadBtn:document.getElementById('downloadBtn'),regenerateBtn:document.getElementById('regenerateBtn'),promptInput:document.getElementById('promptInput')};function updateProgress(progress){const percent=Math.round(progress*100);elements.progressFill.style.width=`${percent}%`;elements.progressPercent.textContent=`${percent}%`}function setModelStatus(status){elements.statusIndicator.className='status-indicator';if(status==='loading'){elements.statusIndicator.classList.add('loading');elements.statusText.textContent=t('modelLoading');elements.loadModelBtn.style.display='none'}else if(status==='ready'){elements.statusIndicator.classList.add('ready');elements.statusText.textContent=t('modelReady');elements.loadModelBtn.style.display='none';elements.generateBtn.disabled=false}}async function loadModel(){if(state.isModelLoaded)return;setModelStatus('loading');elements.progressContainer.style.display='block';for(let i=0;i<=100;i+=5){await new Promise(r=>setTimeout(r,50));updateProgress(i/100)}state.isModelLoaded=true;elements.progressContainer.style.display='none';setModelStatus('ready')}async function generate(){if(!state.isModelLoaded||state.isProcessing)return;state.isProcessing=true;elements.generateBtn.disabled=true;elements.resultArea.style.display='block';elements.processingOverlay.style.display='flex';elements.resultImage.style.display='none';elements.downloadBtn.disabled=true;await new Promise(r=>setTimeout(r,1000));const canvas=document.createElement('canvas');canvas.width=512;canvas.height=512;const ctx=canvas.getContext('2d');const gradient=ctx.createLinearGradient(0,0,512,512);gradient.addColorStop(0,'#06b6d4');gradient.addColorStop(1,'#0891b2');ctx.fillStyle=gradient;ctx.fillRect(0,0,512,512);ctx.fillStyle='rgba(255,255,255,0.1)';for(let i=0;i<20;i++){ctx.beginPath();ctx.arc(Math.random()*512,Math.random()*512,Math.random()*50+10,0,Math.PI*2);ctx.fill()}ctx.fillStyle='rgba(255,255,255,0.9)';ctx.font='bold 24px Arial';ctx.textAlign='center';ctx.fillText('Tiny Diffusion',256,256);canvas.toBlob(blob=>{state.resultBlob=blob;elements.resultImage.src=URL.createObjectURL(blob);elements.resultImage.style.display='block';elements.processingOverlay.style.display='none';elements.downloadBtn.disabled=false},'image/png');state.isProcessing=false;elements.generateBtn.disabled=false}function downloadResult(){if(!state.resultBlob)return;const link=document.createElement('a');link.href=URL.createObjectURL(state.resultBlob);link.download=`tiny-diffusion-${Date.now()}.png`;link.click()}function init(){document.getElementById('lang-zh').addEventListener('click',()=>setLanguage('zh-TW'));document.getElementById('lang-en').addEventListener('click',()=>setLanguage('en'));elements.loadModelBtn.addEventListener('click',loadModel);elements.qualitySlider?.addEventListener('input',e=>{const labels=['低','中','高'];elements.qualityValue.textContent=labels[e.target.value-1]||'中'});elements.generateBtn.addEventListener('click',generate);elements.regenerateBtn.addEventListener('click',generate);elements.downloadBtn.addEventListener('click',downloadResult);setLanguage(navigator.language.startsWith('zh')?'zh-TW':'en')}init();
